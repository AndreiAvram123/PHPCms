<?php
include "Views/pageElements/Header.phtml";
include "Views/commonLayouts/SearchForm.phtml";
if (isset($view->apiKey)) {

    ?>
    <script>var apiKey = '<?php echo $view->apiKey ?>'</script>
    <?php

}
?>


<div class="row mt-5" xmlns="http://www.w3.org/1999/html">

    <div class="col">
        <h1 class="page-title text-center mb-3">Here are some recent posts</h1>
        <?php
        foreach ($view->posts as $post) {
            $view->post = $post;
            include "PostCard.phtml";
        }
        ?>
    </div>
    <?php
    if (isset($_SESSION['user_id'])) {

        ?>

        <div id="friendsList" class="text-center">
            <div id="header-friends-list" onclick="toggleElement(document.getElementById('friends-list-body'))">
                <p>Friends</p>
            </div>
            <div id="friends-list-body">
                <div class="mt-3 mb-3">
                    <input class="form-control mr-sm-2" autocomplete="off" type="search"
                           placeholder="Search for new people"
                           name="search-text"
                           aria-label="Search"
                           id="friends-search-field"
                           onkeyup="fetchFriendsSuggestions(event, this.value)"
                    >
                </div>
                <?php
                if (isset($view->friends)) {
                    ?>
                    <div id="friend-container">
                        <?php
                        foreach ($view->friends as $friend) {
                            ?>
                            <div>
                                <button class="link-button"
                                        onclick="startChat('<?php echo $_SESSION['user_id'] ?>',
                                                '<?php echo $friend->getUserId() ?>','<?php echo $friend->getUsername() ?>')"><?php echo $friend->getUsername() ?>
                                </button>
                            </div>
                            <?php
                        }
                        ?>
                    </div>
                    <?php
                }
                ?>
                <div id="friends-suggestions-container">

                </div>
            </div>
        </div>

        <?php
    }
    ?>
</div>

<?php

//only show the add post button if the user is logged in
if ($view->isUserLoggedIn) {
    ?>
    <a href="AddPost.php">
        <div class="float-button-left"><i class="fa fa-plus add-button"></i></div>
    </a>
    <?php
}
?>
<form method="get" action="<?php echo $_SERVER['PHP_SELF']; ?>">
    <div class="row mt-4 ">
        <div class="col text-center">
            <input type="hidden" name="currentPageId" value="<?php echo md5($view->currentPage) ?>">
            <!--Make sure that the previous button is disabled if we are on the first page-->
            <button type="submit" name="previousPage"
                    class="btn btn-primary" <?php if ($view->currentPage == 1) echo 'disabled' ?>>Previous page
            </button>
            <!--Make sure that the next button is disabled if we are on the last page-->
            <button type="submit" name="nextPage"
                    class="btn btn-primary" <?php if ($view->currentPage == $view->numberOfPages) echo 'disabled' ?> >
                Next page
            </button>
        </div>
    </div>
</form>


<audio id="notificationAudio">
    <source src="sounds/notification_tone.mp3" type="audio/mpeg">
</audio>
</div>
<script src="Javascript/LiveSearch.js"></script>
</body>
</html>


